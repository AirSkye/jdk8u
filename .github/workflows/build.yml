name: Build JDK 8

on:
  workflow_dispatch:
    inputs:
      TAG:
        description: 'TAG to build'     
        default: 'latest'
        required: true
        type: string
  schedule:
    - cron: '0 0 1 * *'

jobs:
  setup-and-build:
    uses: jorgectf/jdk4ql/.github/workflows/code-scanning.yml@main
    with:
      VERSION: 8
      REPOSITORY: 'openjdk/jdk8u'
      TAG: ${{ github.event.inputs.TAG }}
      CONFIGURE_OPTS: '--with-extra-cflags=-Wno-error --with-extra-cxxflags=-Wno-error --with-freetype-include=/usr/include/freetype2 --with-freetype-lib=/usr/lib/x86_64-linux-gnu --with-boot-jdk=$JAVA_HOME_NOW'
  
  upload-artifact:
    runs-on: ubuntu-latest
    needs: setup-and-build  # 确保在构建完成后运行
    steps:
      - name: Download artifact
        uses: actions/download-artifact@v3
        with:
          name: codeql-database

      - name: Upload CodeQL database as artifact
        uses: actions/upload-artifact@v4
        with:
          name: hutool-code-database
          path: ./codeql-database  # 确保这是从download-artifact步骤中获得的正确路径
